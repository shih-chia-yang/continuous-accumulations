# Pester Importing Tested Function
[[pester]]

## simple file

## import ps1 file
````powershell
# at the top of *.Tests.ps1
BeforeAll { 
    . $PSScriptRoot/*.ps1
}
````

使用`$PSCommandPath`來取得
````powershell
BeforeAll {
    # xxxxxx.Tests.ps1 - .Tests.ps1 + .ps1 = xxxxx.ps1
    . $PSCommandPath.Replace('.Tests.ps1','.ps1')
}
````

| :warning: WARNING          |
|:---------------------------|
| string.Replace()方法識大小寫，確認測試檔案的檔案名稱與字串相符 |

## complex file

- 根據測試內容分類成更多的區塊。每個區塊都由一個`Describe`和`Context`表示，並且在不同區塊指定`BeforeAll`來設定初始化，於`Describe`或`Context`之前執行。確保測試區塊使用同一個設定來避免輸入錯誤和複製貼上錯誤。
- 每個區塊還可以使用`AfterAll`，用來清除測試資料，即使用測試失敗，也能保證`AfterAll`後的測試區塊不受影響。另外還提供`BeforeEach`和`AfterEach`，這兩者可以在每個`It`區塊前後執行。

````powershell
BeforeAll {
    . $PSCommandPath.Replace('.Tests.ps1','.ps1')
}

Describe "Get-Something" {
    Context "Do Something First" {
        It "Given value It return expected" {
            
        }

        It "Given int it return expected" {
            
        }
    }

    Context "Do Something Second" {
        Context "by Condition1" {
            BeforeAll{
                
            }
            It "It will return expected 1" {
                
            }
            
            It "It will return expected 2" {
                
            }
        }

        Context "by Condition 2" {
            BeforeAll{
                
            }

            It "It will return expected list" {
                
            }

            It "It will return expected list 2" {
                
            }
            
        }
    }
}

````

- `Describe`和`Context`兩者之間的差異只在以下2點有所區別
  1. 當-Scope Describe或-Scope Context使用Mock時
  2. In output, when the block information is written to screen. 

## 使用TestCases

- 使用TestCases可以為`It`區塊提供不同的參數測試，減少`It`區塊的重覆
````powershell
BeforeAll{
    
}

Describe "Test-It" {
    Context "Give List" {
        It "Return Expected value" -TestCases@(
            @{name="123",expected=true}
            @{name="456",expected=true}
        ) {
            
        }
    }
}
````

- 以上的範例足以支持90%的測試
Test script parameters
````powershell
param($File)
Describe "File is not empty" {
    
}
````
Expanding data to generate Describe and Context blocks
````powershell
BeforeAll { 
    $files = @(
        "Get-Test.ps1",
        "Get-Test1.ps1" 
    )
}

Describe "function <_> has help" -ForEach $files {
    # ....
}
````


[//begin]: # "Autogenerated link references for markdown compatibility"
[pester]: pester.md "Pester"
[//end]: # "Autogenerated link references"