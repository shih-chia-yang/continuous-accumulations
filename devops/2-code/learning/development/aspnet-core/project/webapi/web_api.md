# web_api

[[what_is_rest]]

[[http_status_code]]

- controller,action,models
1. HttpGet - Retrieve - 200 Ok
2. HttpPost - Created - 201 Ok
3. HttpPut - Update No Comment- 204 Ok
4. HttpDelete- Delete No Comment -204 Ok
5. running API's on the swagger page


- 在類別層級定義route attribute，預設名稱為controller name，ex: HomeController route is `api/Home`，等同`[Route("api/Home")]`

```aspx-csharp
[Route("api/[controller]")]
```

- Controller與ControllerBase
1. ControllerBase：mvc controller基礎類別，不包含view相關的方法與屬性，api不需要view
2. Controller: 是ControllerBase加上view相關功能，用來專門處理web的類別

- 自訂custom model and custom Repository
1. add custom model
2. add custom Repository
3. startup.cs add di register IRepository
4. controller add ctor get DI parameter
5. add GetAll() action & Get(int id) action
6. add Add() Update() Delete() method and actions
7. use postman test web api

> [!IMPORTANT]
> Decorate action methods with the `[ProducesResponseType]` attribute to indicate all the known types and HTTP status codes that the client should expect in a response.

- ex:
```aspx-csharp
[HTTPGet("{id}")]
[ProducesResponseType(200,Type=typeof(Product))]
[ProducesResponseType(404)]
public IActionResult Get (string id)
```

## ControllerBase 預設回應ViewResult

- Ok :  returns http 200 status code ，通常用於回應HTTP GET request
- CreateAtRoute : returns an HTTP 201 status code with the path to the new resource.通常用於回應POST request
- Accepted : returns an HTTP 202 status code表示請求正在處理中但尚未完成，通常用於需要執行時間的background程序
- NoContentResult : returns an HTTP 204 status code.通常用於HTTP DELETE或HTTP PUT動作，回應不需要包含已更新資源
- BadResult : returns an HTTP 400 status code 與參數
- NotFound : returns an HTTP 404 with an automatically populated `ProblemDetails`

## ProblemDetails

```aspx-csharp
// take control of problem details
if(!result.Success)
{
    var problemDetails = new ProblemDetails
    {
        Status=StatusCodes.Status400BadRequest,
        Type="https://localhost:5001/customers/failed-to-delete",
        Title=$"Customer ID {id} found but failed to delete.",
        Detail= "More details like Company Name,Country and so on .",
        Instance = HttpContent.Request.Path
    };
    return BadRequest(problemDetails); // 400 bad request

}
```
[ProblemDetails](https://tools.ietf.org/html/rfc7807)

[read more problemDetails](https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.mvc.problemdetails)

## Testing HTTP request


[//begin]: # "Autogenerated link references for markdown compatibility"
[what_is_rest]: ../../what_is_rest.md "REST"
[http_status_code]: ../todo/http_status_code.md "http_status_code"
[//end]: # "Autogenerated link references"