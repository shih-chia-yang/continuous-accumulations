# 2022-01-05
[[linux]]

## linux 查詢 systemd 日誌

日誌本身是`systemd`管理的系統服務，完整名稱為systemd-journald.service。
會根據從核心、使用者程序、標準輸入和系統服務錯誤收到的記錄資訊，結構化的索引記錄，以收集和儲存記錄資料
````bash
systemctl status systemd-journald
````

- 將日誌設為永久

日誌儲存在`/run/log/journal/`中，由於`/run/`目錄具有易失本性，在重新開機時會遺失記錄資料。若要永久儲存記錄資料，`/var/log/journal`目錄必須存在且具有正確的擁有權和許可權

1. 編輯`/etc/systemd/journald.conf`
```bash
sudo vim /etc/systemd/journald.conf
```

2. 取消註解`Storage=`，並變更為`persistent`

```vim
[journal]
Storage=persistent
#Compress
```
3. 儲存檔案，重新啟動systemd-journald

```bash
systemctl restart systemd-journald
```

## 常用命令參數

- `-f`
只顯示最近的日誌訊息，另外，將新的記錄項目新增到日誌時會列印這些新項目

- `-e`
列印訊息並跳轉到日誌末尾，以便在頁面巡覽區中顯示最新的項目

- `-r`
以反向順序列印記錄訊息，使最新的項目列在最前面

- `-u`
只顯示指定systemd的訊息，等同欄位比對_SYSTEM_UNIT=UNIT
```bash
journalctl -u apache2
```

## 參考資料

[journalctl:日誌](https://documentation.suse.com/zh-tw/sles/12-SP5/html/SLES-all/cha-journalctl.html)

[//begin]: # "Autogenerated link references for markdown compatibility"
[linux]: ../../../../devops/7-operate/learning/env/linux/linux.md "Linux"
[//end]: # "Autogenerated link references"